<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nester AI | Login & Signup</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword,
            signOut,
            updateProfile,
            sendPasswordResetEmail,
            GoogleAuthProvider,
            signInWithPopup
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDpjoHXP_CyXTssdjhSYDQ88ToZkchsnmM",
            authDomain: "nester-d1721.firebaseapp.com",
            databaseURL: "https://nester-d1721-default-rtdb.firebaseio.com",
            projectId: "nester-d1721",
            storageBucket: "nester-d1721.firebasestorage.app",
            messagingSenderId: "88432469248",
            appId: "1:88432469248:web:057e32975b505c4aa4ffe5",
            measurementId: "G-FL216KB02C"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        
        // Make auth available globally
        window.firebaseAuth = auth;
        window.firebaseAuthMethods = {
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            updateProfile,
            sendPasswordResetEmail,
            GoogleAuthProvider,
            signInWithPopup
        };
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff8a00, #e52e71);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(229, 46, 113, 0.5);
        }

        .header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
        }

        .form-container {
            padding: 30px;
        }

        .toggle-container {
            display: flex;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50px;
            margin-bottom: 30px;
            padding: 5px;
            position: relative;
        }

        .toggle-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .toggle-bg {
            position: absolute;
            width: 50%;
            height: calc(100% - 10px);
            background: linear-gradient(135deg, #ff8a00, #e52e71);
            border-radius: 50px;
            top: 5px;
            left: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(229, 46, 113, 0.5);
        }

        .form {
            display: none;
        }

        .form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-text {
            text-align: center;
            color: white;
            margin-bottom: 25px;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .social-login {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .social-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 1rem;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .google-btn {
            background: #DB4437;
            box-shadow: 0 0 10px rgba(219, 68, 55, 0.5);
        }

        .apple-btn {
            background: #000000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .phone-btn {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .google-btn:hover {
            box-shadow: 0 5px 15px rgba(219, 68, 55, 0.7);
        }

        .apple-btn:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
        }

        .phone-btn:hover {
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.7);
        }

        .social-btn i {
            font-size: 1.2rem;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 25px 0;
            color: rgba(255, 255, 255, 0.7);
        }

        .divider::before, .divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.3);
        }

        .divider span {
            padding: 0 15px;
            font-size: 0.9rem;
        }

        .email-section {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-group input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(255, 138, 0, 0.3);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .continue-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #ff8a00, #e52e71);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(229, 46, 113, 0.5);
            margin-bottom: 15px;
        }

        .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(229, 46, 113, 0.7);
        }

        .terms {
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
            margin-top: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .terms a {
            color: #ff8a00;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(255, 138, 0, 0.5);
        }

        .terms a:hover {
            color: #e52e71;
            text-decoration: underline;
            text-shadow: 0 0 10px rgba(229, 46, 113, 0.5);
        }

        .forgot-password {
            text-align: center;
            margin-top: 15px;
        }

        .forgot-password a {
            color: #ff8a00;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .forgot-password a:hover {
            color: #e52e71;
            text-decoration: underline;
        }

        .success-message {
            background: rgba(76, 175, 80, 0.2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
            border: 1px solid rgba(244, 67, 54, 0.5);
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
            display: none;
        }

        .user-info img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-bottom: 10px;
            border: 2px solid #ff8a00;
        }

        .loading {
            position: absolute;
            right: 15px;
        }

        .feature-list {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .feature-list i {
            color: #ff8a00;
            margin-right: 8px;
        }

        .phone-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .phone-modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .phone-modal h3 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .phone-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .country-code {
            width: 80px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .phone-number {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .verify-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #ff8a00, #e52e71);
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .input-error {
            border-color: #f44336 !important;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.5) !important;
        }

        .error-text {
            color: #f44336;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
        }

        .verification-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .verification-modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logout-btn {
            background: linear-gradient(135deg, #b21f1f, #8b0000) !important;
            box-shadow: 0 0 15px rgba(178, 31, 31, 0.5) !important;
        }

        .logout-btn:hover {
            box-shadow: 0 5px 20px rgba(178, 31, 31, 0.7) !important;
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            .form-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-robot"></i> Nester AI</h1>
            <p>Your Intelligent Assistant</p>
        </div>
        
        <div class="form-container">
            <div class="toggle-container">
                <div class="toggle-bg" id="toggleBg"></div>
                <div class="toggle-btn active" id="loginBtn">Log in</div>
                <div class="toggle-btn" id="signupBtn">Sign up</div>
            </div>
            
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i> Authentication successful!
            </div>
            
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i> Authentication failed. Please try again.
            </div>

            <div class="user-info" id="userInfo">
                <img id="userPhoto" src="" alt="User Photo">
                <h3 id="userName">Welcome!</h3>
                <p id="userEmail"></p>
                <button id="logoutBtn" class="continue-btn logout-btn" style="margin-top: 10px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
            <!-- Login Form -->
            <form class="form active" id="loginForm">
                <div class="welcome-text">
                    <h3>Log in to your account</h3>
                </div>
                
                <div class="feature-list">
                    <p><i class="fas fa-brain"></i> You'll get smarter responses</p>
                    <p><i class="fas fa-upload"></i> Upload files, images, and more</p>
                </div>
                
                <div class="social-login">
                    <button type="button" class="social-btn google-btn" id="googleLogin">
                        <i class="fab fa-google"></i> Continue with Google
                        <i class="fas fa-spinner fa-spin loading" style="display: none;"></i>
                    </button>
                    <button type="button" class="social-btn apple-btn" id="appleLogin">
                        <i class="fab fa-apple"></i> Continue with Apple
                        <i class="fas fa-spinner fa-spin loading" style="display: none;"></i>
                    </button>
                    <button type="button" class="social-btn phone-btn" id="phoneLogin">
                        <i class="fas fa-phone"></i> Continue with phone
                        <i class="fas fa-spinner fa-spin loading" style="display: none;"></i>
                    </button>
                </div>
                
                <div class="divider">
                    <span>OR</span>
                </div>
                
                <div class="email-section">
                    <div class="form-group">
                        <input type="email" id="loginEmail" placeholder="Email address" required>
                        <div class="error-text" id="loginEmailError">Please enter a valid email address</div>
                    </div>
                    <div class="form-group">
                        <input type="password" id="loginPassword" placeholder="Password" required>
                        <button type="button" class="password-toggle" id="loginPasswordToggle">
                            <i class="fas fa-eye"></i>
                        </button>
                        <div class="error-text" id="loginPasswordError">Password is required</div>
                    </div>
                    <button type="submit" class="continue-btn">
                        Log In
                    </button>
                </div>
                
                <div class="forgot-password">
                    <a href="#" id="forgotPassword">Forgot your password?</a>
                </div>
            </form>
            
            <!-- Signup Form -->
            <form class="form" id="signupForm">
                <div class="welcome-text">
                    <h3>Create a new account</h3>
                </div>
                
                <div class="feature-list">
                    <p><i class="fas fa-brain"></i> You'll get smarter responses</p>
                    <p><i class="fas fa-upload"></i> Upload files, images, and more</p>
                </div>
                
                <div class="social-login">
                    <button type="button" class="social-btn google-btn" id="googleSignup">
                        <i class="fab fa-google"></i> Continue with Google
                        <i class="fas fa-spinner fa-spin loading" style="display: none;"></i>
                    </button>
                    <button type="button" class="social-btn apple-btn" id="appleSignup">
                        <i class="fab fa-apple"></i> Continue with Apple
                        <i class="fas fa-spinner fa-spin loading" style="display: none;"></i>
                    </button>
                    <button type="button" class="social-btn phone-btn" id="phoneSignup">
                        <i class="fas fa-phone"></i> Continue with phone
                        <i class="fas fa-spinner fa-spin loading" style="display: none;"></i>
                    </button>
                </div>
                
                <div class="divider">
                    <span>OR</span>
                </div>
                
                <div class="email-section">
                    <div class="form-group">
                        <input type="text" id="signupName" placeholder="Full name" required>
                        <div class="error-text" id="signupNameError">Please enter your full name</div>
                    </div>
                    <div class="form-group">
                        <input type="email" id="signupEmail" placeholder="Email address" required>
                        <div class="error-text" id="signupEmailError">Please enter a valid email address</div>
                    </div>
                    <div class="form-group">
                        <input type="password" id="signupPassword" placeholder="Password" required>
                        <button type="button" class="password-toggle" id="signupPasswordToggle">
                            <i class="fas fa-eye"></i>
                        </button>
                        <div class="error-text" id="signupPasswordError">Password must be at least 8 characters</div>
                    </div>
                    <div class="form-group">
                        <input type="password" id="signupConfirmPassword" placeholder="Confirm password" required>
                        <div class="error-text" id="signupConfirmPasswordError">Passwords do not match</div>
                    </div>
                    <button type="submit" class="continue-btn">
                        Create Account
                    </button>
                </div>
                
                <div class="terms">
                    By creating an account, you agree to our 
                    <a href="#" id="termsLink">Terms of Service</a> and 
                    <a href="#" id="privacyLink">Privacy Policy</a>.
                </div>
            </form>
        </div>
    </div>

    <!-- Phone Verification Modal -->
    <div class="phone-modal" id="phoneModal">
        <div class="phone-modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <h3>Enter your phone number</h3>
            <div class="phone-input-group">
                <select class="country-code" id="countryCode">
                    <option value="+91" selected>+91 IN</option>
                    <option value="+1">+1 US</option>
                    <option value="+44">+44 UK</option>
                    <option value="+61">+61 AU</option>
                    <option value="+81">+81 JP</option>
                </select>
                <input type="tel" class="phone-number" id="phoneNumber" placeholder="9876543210" required>
            </div>
            <div class="error-text" id="phoneError" style="text-align: center; margin-bottom: 10px;"></div>
            <button class="verify-btn" id="sendVerification">Send Verification Code</button>
        </div>
    </div>

    <!-- Verification Code Modal -->
    <div class="verification-modal" id="verificationModal">
        <div class="verification-modal-content">
            <button class="close-modal" id="closeVerificationModal">&times;</button>
            <h3>Enter Verification Code</h3>
            <div class="form-group">
                <input type="text" id="verificationCode" placeholder="Enter 6-digit code" required>
                <div class="error-text" id="verificationError" style="text-align: center;"></div>
            </div>
            <button class="verify-btn" id="verifyCode">Verify Code</button>
        </div>
    </div>

    <script>
        // Wait for Firebase to load
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const loginBtn = document.getElementById('loginBtn');
            const signupBtn = document.getElementById('signupBtn');
            const toggleBg = document.getElementById('toggleBg');
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const userInfo = document.getElementById('userInfo');
            const userPhoto = document.getElementById('userPhoto');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            const logoutBtn = document.getElementById('logoutBtn');
            const googleLogin = document.getElementById('googleLogin');
            const appleLogin = document.getElementById('appleLogin');
            const phoneLogin = document.getElementById('phoneLogin');
            const googleSignup = document.getElementById('googleSignup');
            const appleSignup = document.getElementById('appleSignup');
            const phoneSignup = document.getElementById('phoneSignup');
            const forgotPassword = document.getElementById('forgotPassword');
            const termsLink = document.getElementById('termsLink');
            const privacyLink = document.getElementById('privacyLink');
            const phoneModal = document.getElementById('phoneModal');
            const closeModal = document.getElementById('closeModal');
            const sendVerification = document.getElementById('sendVerification');
            const countryCode = document.getElementById('countryCode');
            const phoneNumber = document.getElementById('phoneNumber');
            const phoneError = document.getElementById('phoneError');
            const verificationModal = document.getElementById('verificationModal');
            const closeVerificationModal = document.getElementById('closeVerificationModal');
            const verificationCode = document.getElementById('verificationCode');
            const verifyCode = document.getElementById('verifyCode');
            const verificationError = document.getElementById('verificationError');

            // Input elements
            const loginEmail = document.getElementById('loginEmail');
            const loginPassword = document.getElementById('loginPassword');
            const loginPasswordToggle = document.getElementById('loginPasswordToggle');
            const signupName = document.getElementById('signupName');
            const signupEmail = document.getElementById('signupEmail');
            const signupPassword = document.getElementById('signupPassword');
            const signupPasswordToggle = document.getElementById('signupPasswordToggle');
            const signupConfirmPassword = document.getElementById('signupConfirmPassword');

            // Error elements
            const loginEmailError = document.getElementById('loginEmailError');
            const loginPasswordError = document.getElementById('loginPasswordError');
            const signupNameError = document.getElementById('signupNameError');
            const signupEmailError = document.getElementById('signupEmailError');
            const signupPasswordError = document.getElementById('signupPasswordError');
            const signupConfirmPasswordError = document.getElementById('signupConfirmPasswordError');

            let confirmationResult = null;

            // Check if user is already logged in
            if (window.firebaseAuth) {
                window.firebaseAuth.onAuthStateChanged((user) => {
                    if (user) {
                        // User is signed in, redirect to home.html
                        window.location.href = "home.html";
                    }
                });
            }

            // Toggle between login and signup forms
            loginBtn.addEventListener('click', () => {
                loginBtn.classList.add('active');
                signupBtn.classList.remove('active');
                toggleBg.style.left = '5px';
                loginForm.classList.add('active');
                signupForm.classList.remove('active');
                clearMessages();
                clearFormErrors();
            });

            signupBtn.addEventListener('click', () => {
                signupBtn.classList.add('active');
                loginBtn.classList.remove('active');
                toggleBg.style.left = 'calc(50% + 5px)';
                signupForm.classList.add('active');
                loginForm.classList.remove('active');
                clearMessages();
                clearFormErrors();
            });

            // Password toggle functionality
            loginPasswordToggle.addEventListener('click', () => {
                const type = loginPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                loginPassword.setAttribute('type', type);
                loginPasswordToggle.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });

            signupPasswordToggle.addEventListener('click', () => {
                const type = signupPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                signupPassword.setAttribute('type', type);
                signupPasswordToggle.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });

            // Form validation
            function validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            function validatePassword(password) {
                return password.length >= 8;
            }

            function validatePhone(phone) {
                const re = /^\d{10}$/;
                return re.test(phone);
            }

            // Show input error
            function showInputError(input, errorElement, message) {
                input.classList.add('input-error');
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }

            // Hide input error
            function hideInputError(input, errorElement) {
                input.classList.remove('input-error');
                errorElement.style.display = 'none';
            }

            // Clear all form errors
            function clearFormErrors() {
                const inputs = document.querySelectorAll('input');
                inputs.forEach(input => input.classList.remove('input-error'));
                
                const errors = document.querySelectorAll('.error-text');
                errors.forEach(error => error.style.display = 'none');
            }

            // Login form submission
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                clearFormErrors();
                
                let isValid = true;
                
                // Validate email
                if (!loginEmail.value) {
                    showInputError(loginEmail, loginEmailError, 'Email is required');
                    isValid = false;
                } else if (!validateEmail(loginEmail.value)) {
                    showInputError(loginEmail, loginEmailError, 'Please enter a valid email address');
                    isValid = false;
                }
                
                // Validate password
                if (!loginPassword.value) {
                    showInputError(loginPassword, loginPasswordError, 'Password is required');
                    isValid = false;
                }
                
                if (isValid && window.firebaseAuthMethods) {
                    const submitBtn = loginForm.querySelector('.continue-btn');
                    const originalText = submitBtn.textContent;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
                    submitBtn.disabled = true;
                    
                    // Firebase email login
                    window.firebaseAuthMethods.signInWithEmailAndPassword(window.firebaseAuth, loginEmail.value, loginPassword.value)
                        .then((userCredential) => {
                            const user = userCredential.user;
                            showSuccess('Login successful! Redirecting...');
                            
                            // Redirect to home.html after successful login
                            setTimeout(() => {
                                window.location.href = "home.html";
                            }, 1500);
                        })
                        .catch((error) => {
                            let errorMessage = 'Login failed. Please try again.';
                            
                            if (error.code === 'auth/user-not-found') {
                                errorMessage = 'No account found with this email. Please sign up first.';
                            } else if (error.code === 'auth/wrong-password') {
                                errorMessage = 'Incorrect password. Please try again.';
                            } else if (error.code === 'auth/invalid-email') {
                                errorMessage = 'Invalid email address.';
                            }
                            
                            showError(errorMessage);
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        });
                }
            });

            // Signup form submission
            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                clearFormErrors();
                
                let isValid = true;
                
                // Validate name
                if (!signupName.value.trim()) {
                    showInputError(signupName, signupNameError, 'Full name is required');
                    isValid = false;
                }
                
                // Validate email
                if (!signupEmail.value) {
                    showInputError(signupEmail, signupEmailError, 'Email is required');
                    isValid = false;
                } else if (!validateEmail(signupEmail.value)) {
                    showInputError(signupEmail, signupEmailError, 'Please enter a valid email address');
                    isValid = false;
                }
                
                // Validate password
                if (!signupPassword.value) {
                    showInputError(signupPassword, signupPasswordError, 'Password is required');
                    isValid = false;
                } else if (!validatePassword(signupPassword.value)) {
                    showInputError(signupPassword, signupPasswordError, 'Password must be at least 8 characters');
                    isValid = false;
                }
                
                // Validate confirm password
                if (!signupConfirmPassword.value) {
                    showInputError(signupConfirmPassword, signupConfirmPasswordError, 'Please confirm your password');
                    isValid = false;
                } else if (signupPassword.value !== signupConfirmPassword.value) {
                    showInputError(signupConfirmPassword, signupConfirmPasswordError, 'Passwords do not match');
                    isValid = false;
                }
                
                if (isValid && window.firebaseAuthMethods) {
                    const submitBtn = signupForm.querySelector('.continue-btn');
                    const originalText = submitBtn.textContent;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';
                    submitBtn.disabled = true;
                    
                    // Firebase email signup
                    window.firebaseAuthMethods.createUserWithEmailAndPassword(window.firebaseAuth, signupEmail.value, signupPassword.value)
                        .then((userCredential) => {
                            const user = userCredential.user;
                            
                            // Update user profile with name
                            return window.firebaseAuthMethods.updateProfile(user, {
                                displayName: signupName.value.trim()
                            }).then(() => {
                                showSuccess('Account created successfully! Redirecting...');
                                
                                // Redirect to home.html after successful signup
                                setTimeout(() => {
                                    window.location.href = "home.html";
                                }, 1500);
                            });
                        })
                        .catch((error) => {
                            let errorMessage = 'Sign up failed. Please try again.';
                            
                            if (error.code === 'auth/email-already-in-use') {
                                errorMessage = 'Email already registered. Please log in instead.';
                            } else if (error.code === 'auth/weak-password') {
                                errorMessage = 'Password is too weak. Please use a stronger password.';
                            } else if (error.code === 'auth/invalid-email') {
                                errorMessage = 'Invalid email address.';
                            }
                            
                            showError(errorMessage);
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        });
                }
            });

            // Google Authentication
            googleLogin.addEventListener('click', () => {
                loginWithGoogle(googleLogin);
            });

            googleSignup.addEventListener('click', () => {
                loginWithGoogle(googleSignup);
            });

            function loginWithGoogle(button) {
                if (!window.firebaseAuthMethods) {
                    showError('Firebase not loaded yet. Please try again.');
                    return;
                }
                
                const provider = new window.firebaseAuthMethods.GoogleAuthProvider();
                
                const loadingIcon = button.querySelector('.loading');
                loadingIcon.style.display = 'inline-block';
                button.disabled = true;
                
                window.firebaseAuthMethods.signInWithPopup(window.firebaseAuth, provider)
                    .then((result) => {
                        const user = result.user;
                        showSuccess('Google authentication successful! Redirecting...');
                        
                        // Redirect to home.html after successful login
                        setTimeout(() => {
                            window.location.href = "home.html";
                        }, 1500);
                    })
                    .catch((error) => {
                        let errorMessage = 'Google authentication failed. Please try again.';
                        
                        if (error.code === 'auth/unauthorized-domain') {
                            errorMessage = 'Domain not authorized. Please add your domain to Firebase authorized domains.';
                        } else if (error.code === 'auth/popup-closed-by-user') {
                            errorMessage = 'Authentication cancelled.';
                        }
                        
                        showError(errorMessage);
                        loadingIcon.style.display = 'none';
                        button.disabled = false;
                    });
            }

            // Apple Authentication (Simulated - would require proper configuration)
            appleLogin.addEventListener('click', () => {
                simulateAppleLogin(appleLogin);
            });

            appleSignup.addEventListener('click', () => {
                simulateAppleLogin(appleSignup);
            });

            function simulateAppleLogin(button) {
                const loadingIcon = button.querySelector('.loading');
                loadingIcon.style.display = 'inline-block';
                button.disabled = true;
                
                setTimeout(() => {
                    showError('Apple Sign In requires additional configuration in Firebase.');
                    loadingIcon.style.display = 'none';
                    button.disabled = false;
                }, 2000);
            }

            // Phone authentication
            phoneLogin.addEventListener('click', () => {
                showPhoneModal();
            });

            phoneSignup.addEventListener('click', () => {
                showPhoneModal();
            });

            function showPhoneModal() {
                phoneModal.style.display = 'flex';
                phoneError.style.display = 'none';
                phoneNumber.value = '';
            }

            closeModal.addEventListener('click', () => {
                phoneModal.style.display = 'none';
            });

            sendVerification.addEventListener('click', () => {
                const fullPhoneNumber = countryCode.value + phoneNumber.value;
                
                if (!phoneNumber.value) {
                    phoneError.textContent = 'Please enter your phone number';
                    phoneError.style.display = 'block';
                    return;
                }
                
                if (!validatePhone(phoneNumber.value)) {
                    phoneError.textContent = 'Please enter a valid 10-digit phone number';
                    phoneError.style.display = 'block';
                    return;
                }
                
                const loadingIcon = sendVerification.querySelector('.loading');
                if (!loadingIcon) {
                    sendVerification.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                } else {
                    loadingIcon.style.display = 'inline-block';
                }
                sendVerification.disabled = true;
                
                // Simulate sending verification code
                setTimeout(() => {
                    confirmationResult = { confirm: () => Promise.resolve({ user: {} }) }; // Mock confirmation result
                    phoneModal.style.display = 'none';
                    verificationModal.style.display = 'flex';
                    showSuccess(`Verification code sent to ${fullPhoneNumber}`);
                    
                    sendVerification.disabled = false;
                    sendVerification.innerHTML = 'Send Verification Code';
                }, 2000);
            });

            // Verify phone code
            closeVerificationModal.addEventListener('click', () => {
                verificationModal.style.display = 'none';
            });

            verifyCode.addEventListener('click', () => {
                const code = verificationCode.value;
                
                if (!code) {
                    verificationError.textContent = 'Please enter the verification code';
                    verificationError.style.display = 'block';
                    return;
                }
                
                verifyCode.disabled = true;
                verifyCode.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
                
                // Simulate verification
                setTimeout(() => {
                    verificationModal.style.display = 'none';
                    showSuccess('Phone verification successful! Redirecting...');
                    
                    // Redirect to home.html after successful phone verification
                    setTimeout(() => {
                        window.location.href = "home.html";
                    }, 1500);
                    
                    verifyCode.disabled = false;
                    verifyCode.innerHTML = 'Verify Code';
                }, 2000);
            });

            // Forgot Password
            forgotPassword.addEventListener('click', (e) => {
                e.preventDefault();
                const email = loginEmail.value;
                
                if (!email) {
                    showError('Please enter your email address first.');
                    return;
                }
                
                if (!validateEmail(email)) {
                    showError('Please enter a valid email address.');
                    return;
                }
                
                if (window.firebaseAuthMethods) {
                    window.firebaseAuthMethods.sendPasswordResetEmail(window.firebaseAuth, email)
                        .then(() => {
                            showSuccess('Password reset email sent! Check your inbox.');
                        })
                        .catch((error) => {
                            let errorMessage = 'Error sending reset email. Please try again.';
                            
                            if (error.code === 'auth/user-not-found') {
                                errorMessage = 'No account found with this email address.';
                            }
                            
                            showError(errorMessage);
                        });
                }
            });

            // Terms and Privacy
            termsLink.addEventListener('click', (e) => {
                e.preventDefault();
                showSuccess('Terms of Service would be displayed here!');
            });

            privacyLink.addEventListener('click', (e) => {
                e.preventDefault();
                showSuccess('Privacy Policy would be displayed here!');
            });

            // Logout
            logoutBtn.addEventListener('click', () => {
                if (window.firebaseAuthMethods) {
                    window.firebaseAuthMethods.signOut(window.firebaseAuth)
                        .then(() => {
                            showSuccess('You have been logged out successfully.');
                            hideUserInfo();
                        })
                        .catch((error) => {
                            showError(error.message);
                        });
                }
            });

            // Show user info
            function showUserInfo(user) {
                userInfo.style.display = 'block';
                loginForm.style.display = 'none';
                signupForm.style.display = 'none';
                
                if (user.photoURL) {
                    userPhoto.src = user.photoURL;
                    userPhoto.style.display = 'block';
                } else {
                    // Generate a placeholder avatar based on name or email
                    const name = user.displayName || user.email.split('@')[0] || 'User';
                    const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
                    userPhoto.src = `https://ui-avatars.com/api/?name=${initials}&background=ff8a00&color=fff&size=60`;
                    userPhoto.style.display = 'block';
                }
                
                userName.textContent = `Welcome, ${user.displayName || 'User'}!`;
                userEmail.textContent = user.email || user.phoneNumber || '';
            }

            function hideUserInfo() {
                userInfo.style.display = 'none';
                loginForm.style.display = 'block';
                loginForm.reset();
                signupForm.reset();
                clearFormErrors();
            }

            // Show success message
            function showSuccess(message) {
                successMessage.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 5000);
            }

            // Show error message
            function showError(message) {
                errorMessage.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
                
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }

            // Clear messages
            function clearMessages() {
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
            }

            // Real-time validation
            loginEmail.addEventListener('input', () => {
                if (loginEmail.value && !validateEmail(loginEmail.value)) {
                    showInputError(loginEmail, loginEmailError, 'Please enter a valid email address');
                } else {
                    hideInputError(loginEmail, loginEmailError);
                }
            });

            signupEmail.addEventListener('input', () => {
                if (signupEmail.value && !validateEmail(signupEmail.value)) {
                    showInputError(signupEmail, signupEmailError, 'Please enter a valid email address');
                } else {
                    hideInputError(signupEmail, signupEmailError);
                }
            });

            signupPassword.addEventListener('input', () => {
                if (signupPassword.value && !validatePassword(signupPassword.value)) {
                    showInputError(signupPassword, signupPasswordError, 'Password must be at least 8 characters');
                } else {
                    hideInputError(signupPassword, signupPasswordError);
                }
                
                // Update confirm password validation
                if (signupConfirmPassword.value && signupPassword.value !== signupConfirmPassword.value) {
                    showInputError(signupConfirmPassword, signupConfirmPasswordError, 'Passwords do not match');
                } else {
                    hideInputError(signupConfirmPassword, signupConfirmPasswordError);
                }
            });

            signupConfirmPassword.addEventListener('input', () => {
                if (signupConfirmPassword.value && signupPassword.value !== signupConfirmPassword.value) {
                    showInputError(signupConfirmPassword, signupConfirmPasswordError, 'Passwords do not match');
                } else {
                    hideInputError(signupConfirmPassword, signupConfirmPasswordError);
                }
            });

            // Initialize the page
            console.log('Nester AI Authentication Page Loaded');
            // Set Indian phone number as default
            countryCode.value = '+91';
            phoneNumber.placeholder = '9876543210';
        });
    </script>
</body>
</html>
